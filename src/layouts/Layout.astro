---
import '../styles/global.css';
const { title, lang = 'es' } = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<script is:inline>
			// Prevent flash of unstyled content (FOUC) for dark mode
			const getTheme = () => {
				if (typeof localStorage !== 'undefined' && localStorage.getItem('color-theme')) {
					return localStorage.getItem('color-theme');
				}
				return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			};
			
			if (getTheme() === 'dark') {
				document.documentElement.classList.add('dark');
			} else {
				document.documentElement.classList.remove('dark');
			}
		</script>
	</head>
	<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
		<slot />
		
		<script is:inline>
			// Theme toggle functionality - runs globally once
			(function() {
				function getTheme() {
					if (typeof localStorage !== 'undefined' && localStorage.getItem('color-theme')) {
						return localStorage.getItem('color-theme');
					}
					return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
				}

				function updateIcons() {
					const theme = getTheme();
					const moonIcons = document.querySelectorAll('.theme-icon-moon');
					const sunIcons = document.querySelectorAll('.theme-icon-sun');
					
					if (theme === 'dark') {
						moonIcons.forEach(icon => icon.classList.add('hidden'));
						sunIcons.forEach(icon => icon.classList.remove('hidden'));
					} else {
						moonIcons.forEach(icon => icon.classList.remove('hidden'));
						sunIcons.forEach(icon => icon.classList.add('hidden'));
					}
				}

				function setTheme(newTheme) {
					if (newTheme === 'dark') {
						document.documentElement.classList.add('dark');
					} else {
						document.documentElement.classList.remove('dark');
					}
					localStorage.setItem('color-theme', newTheme);
					updateIcons();
				}

				// Initialize icons on page load
				document.addEventListener('DOMContentLoaded', function() {
					updateIcons();
					
					// Add click handlers to all toggle buttons
					const toggleButtons = document.querySelectorAll('.theme-toggle');
					toggleButtons.forEach(button => {
						button.addEventListener('click', function(e) {
							e.preventDefault();
							const currentTheme = getTheme();
							const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
							setTheme(newTheme);
						});
					});
				});
			})();

			// Language selector functionality - runs globally once
			(function() {
				function initLanguageSelector() {
					// Find all language selectors
					const selectors = document.querySelectorAll('.language-selector');
					
					selectors.forEach((selector) => {
						const button = selector.querySelector('.language-button');
						const dropdown = selector.querySelector('.language-dropdown');
						
						if (!button || !dropdown) return;
						
						// Track if we've handled an event recently to prevent double-firing
						let eventHandled = false;
						
						// Toggle function - only for button clicks
						function toggleDropdown(e) {
							// Only process if clicking on button, not dropdown
							if (!e.target.closest('.language-button')) {
								return;
							}
							
							// Prevent multiple events from firing in quick succession
							if (eventHandled) {
								e.preventDefault();
								e.stopPropagation();
								return;
							}
							
							eventHandled = true;
							setTimeout(() => { eventHandled = false; }, 500);
							
							e.preventDefault();
							e.stopPropagation();
							
							// Close all other dropdowns
							document.querySelectorAll('.language-dropdown').forEach(d => {
								if (d !== dropdown) {
									d.classList.add('hidden');
								}
							});
							
							// Toggle this dropdown
							dropdown.classList.toggle('hidden');
						}
						
						// Add listeners only to the button
						button.addEventListener('pointerdown', toggleDropdown, false);
						button.addEventListener('touchstart', toggleDropdown, false);
						button.addEventListener('click', toggleDropdown, false);
					});
					
					// Close dropdown when clicking/touching outside
					document.addEventListener('pointerdown', function(e) {
						const isButton = e.target.closest('.language-button');
						const isDropdown = e.target.closest('.language-dropdown');
						
						// Close dropdown if clicking outside (but not on button or dropdown)
						if (!isButton && !isDropdown) {
							document.querySelectorAll('.language-dropdown').forEach(dropdown => {
								dropdown.classList.add('hidden');
							});
						}
					}, false);
				}
				
				// Initialize when DOM is ready with a slight delay to ensure everything is loaded
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', function() {
						setTimeout(initLanguageSelector, 100);
					});
				} else {
					setTimeout(initLanguageSelector, 100);
				}
			})();
		</script>
	</body>
</html>
