---
import '../styles/global.css';
const { title, lang = 'es' } = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<script is:inline>
			// Prevent flash of unstyled content (FOUC) for dark mode
			const getTheme = () => {
				if (typeof localStorage !== 'undefined' && localStorage.getItem('color-theme')) {
					return localStorage.getItem('color-theme');
				}
				return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			};
			
			if (getTheme() === 'dark') {
				document.documentElement.classList.add('dark');
			} else {
				document.documentElement.classList.remove('dark');
			}
		</script>
	</head>
	<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
		<slot />
		
		<script is:inline>
			// Theme toggle functionality - runs globally once
			(function() {
				console.log('Theme toggle script loaded');
				
				function getTheme() {
					if (typeof localStorage !== 'undefined' && localStorage.getItem('color-theme')) {
						return localStorage.getItem('color-theme');
					}
					return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
				}

				function updateIcons() {
					const theme = getTheme();
					const moonIcons = document.querySelectorAll('.theme-icon-moon');
					const sunIcons = document.querySelectorAll('.theme-icon-sun');
					
					console.log('Updating icons for theme:', theme);
					console.log('Moon icons found:', moonIcons.length);
					console.log('Sun icons found:', sunIcons.length);
					
					if (theme === 'dark') {
						moonIcons.forEach(icon => icon.classList.add('hidden'));
						sunIcons.forEach(icon => icon.classList.remove('hidden'));
					} else {
						moonIcons.forEach(icon => icon.classList.remove('hidden'));
						sunIcons.forEach(icon => icon.classList.add('hidden'));
					}
				}

				function setTheme(newTheme) {
					console.log('Setting theme to:', newTheme);
					if (newTheme === 'dark') {
						document.documentElement.classList.add('dark');
					} else {
						document.documentElement.classList.remove('dark');
					}
					localStorage.setItem('color-theme', newTheme);
					updateIcons();
				}

				// Initialize icons on page load
				document.addEventListener('DOMContentLoaded', function() {
					console.log('DOM loaded, initializing theme toggle');
					updateIcons();
					
					// Add click handlers to all toggle buttons
					const toggleButtons = document.querySelectorAll('.theme-toggle');
					console.log('Toggle buttons found:', toggleButtons.length);
					
					toggleButtons.forEach((button, index) => {
						console.log('Adding listener to button', index);
						button.addEventListener('click', function(e) {
							console.log('Button clicked!');
							e.preventDefault();
							const currentTheme = getTheme();
							const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
							setTheme(newTheme);
						});
					});
				});
			})();
		</script>
	</body>
</html>
